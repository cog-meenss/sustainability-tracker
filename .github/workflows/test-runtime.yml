name: Test Runtime Sustainability

on:
  workflow_dispatch:

jobs:
  test-runtime:
    runs-on: ubuntu-latest
    steps:
    - name: ðŸ“¥ Checkout
      uses: actions/checkout@v4
      
    - name: ðŸ Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.9'
        
    - name: ðŸ“¦ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install radon xenon bandit safety pylint flake8 mypy
        
    - name: ðŸ”„ Test Runtime Reporter
      run: |
        echo "Testing runtime sustainability reporter..."
        
        # Make executable
        chmod +x runtime_sustainability_reporter.py
        chmod +x sustainability-analyzer/analyzer/sustainability_analyzer.py
        
        # Test basic functionality
        python3 runtime_sustainability_reporter.py --path . --format console
        
    - name: ðŸ“Š Generate Test Reports
      run: |
        echo "Generating test reports..."
        
        # Generate reports
        python3 runtime_sustainability_reporter.py --path . --format json --output test_report.json
        
        # Verify file exists
        ls -la test_report.json
        
        # Show sample content
        head -10 test_report.json
        
    - name: ðŸ“‹ Create Simple Job Summary
      run: |
        echo "Creating simple job summary..."
        
        # Create basic job summary
        cat >> $GITHUB_STEP_SUMMARY << 'EOF'
        # ðŸ”„ Test Runtime Sustainability Analysis
        
        ## Test Results âœ…
        
        - Runtime reporter: Working
        - Report generation: Success
        - File creation: Confirmed
        
        ## Sample Metrics
        
        | Metric | Status |
        |--------|--------|
        | Runtime Reporter | âœ… Working |
        | JSON Generation | âœ… Working |
        | Console Output | âœ… Working |
        
        This is a test of the job summary functionality.
        EOF
        
        echo "Job summary created successfully"