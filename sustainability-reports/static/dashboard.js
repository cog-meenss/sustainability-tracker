// Rich interactive dashboard script generated by sustainability_evaluator
(function(){
    try {
        const el = document.getElementById('report-data');
        const data = el ? JSON.parse(el.textContent || '{}') : {};

        // Create container elements for charts and panels if not present
        const container = document.querySelector('.container');
        if (!container) return;

        // Create tabs
        const tabsHtml = `
            <div style="display:flex;gap:12px;margin:18px 0;">
                <button data-tab="overview" class="tab-btn">Overview</button>
                <button data-tab="files" class="tab-btn">Files</button>
                <button data-tab="reco" class="tab-btn">Recommendations</button>
            </div>
        `;
        const tabsDiv = document.createElement('div');
        tabsDiv.innerHTML = tabsHtml;
        container.insertBefore(tabsDiv, container.children[1]);

        // Create tab content nodes
        const overview = document.createElement('div'); overview.id='tab-overview'; overview.className='tab-content';
        const files = document.createElement('div'); files.id='tab-files'; files.className='tab-content';
        const reco = document.createElement('div'); reco.id='tab-reco'; reco.className='tab-content';
        container.appendChild(overview); container.appendChild(files); container.appendChild(reco);

        // Style: simple
        const style = document.createElement('style');
        style.textContent = `
            .tab-content{display:none;margin-top:12px}
            .tab-content.active{display:block}
            .tab-btn{padding:8px 12px;border-radius:8px;border:1px solid #ddd;background:white;cursor:pointer}
            .tab-btn.active{background:linear-gradient(90deg,#2ecc71,#16a085);color:white}
            .progress{background:#eee;border-radius:8px;height:12px;width:100%}
            .progress-fill{height:100%;background:linear-gradient(90deg,#2ecc71,#2ecc71);border-radius:8px}
        `;
        document.head.appendChild(style);

        // Activate Overview by default
        function activateTab(name){
            document.querySelectorAll('.tab-btn').forEach(b=>{b.classList.toggle('active', b.getAttribute('data-tab')===name)});
            document.querySelectorAll('.tab-content').forEach(t=>t.classList.toggle('active', t.id==='tab-'+name));
        }
        document.querySelectorAll('.tab-btn').forEach(b=>b.addEventListener('click', ()=>activateTab(b.getAttribute('data-tab'))));
        activateTab('overview');

        // Overview content: small metrics and radar/bar charts
        overview.innerHTML = `<div style="display:flex;gap:20px;flex-wrap:wrap">
      <div style="flex:1;min-width:260px;">
        <h3>Key Metrics</h3>
        <div id='metrics-cards'></div>
      </div>
      <div style="flex:2;min-width:320px;">
        <h3>Trends</h3>
        <canvas id='trendChart' style='width:100%;max-height:320px'></canvas>
      </div>
    </div>`;

        // Files tab: list top files
        files.innerHTML = `<h3>Top files</h3><div id='files-list'></div>`;

        // Recommendations tab
        reco.innerHTML = `<h3>Recommendations</h3><div id='reco-list'></div>`;

        // Populate metrics cards
        const metricsNode = document.getElementById('metrics-cards');
        const keys = ['overall_score','energy_efficiency','resource_utilization','performance_optimization','code_quality'];
        keys.forEach(k=>{
            const v = data.sustainability_metrics && data.sustainability_metrics[k] !== undefined ? data.sustainability_metrics[k] : 'N/A';
            const card = document.createElement('div');
            card.style.padding='12px'; card.style.margin='8px 0'; card.style.border='1px solid #eee'; card.style.borderRadius='10px';
            card.innerHTML = `<strong>${k.replace(/_/g,' ')}:</strong> <span class='metric-value'>${v}</span>
        <div class='progress' aria-hidden='true' style='margin-top:8px'><div class='progress-fill' style='width:${(typeof v==='number'?v:0)}%'></div></div>`;
            metricsNode.appendChild(card);
        });

        // Trend chart (line) using Chart.js
        const trendCtx = document.getElementById('trendChart').getContext('2d');
        const trendData = {
            labels: ['Jan','Feb','Mar','Apr','May','Jun'],
            datasets: [{label:'Overall Score',data:[60,65,70,72,75,(data.sustainability_metrics&&data.sustainability_metrics.overall_score)||75],borderColor:'#2c3e50',backgroundColor:'rgba(44,62,80,0.08)',tension:0.3}]
        };
        new Chart(trendCtx,{type:'line',data:trendData, options:{responsive:true,plugins:{legend:{display:false}}}});

        // Files list
        const filesList = document.getElementById('files-list');
        const fileData = (data.detailed_analysis && data.detailed_analysis.file_complexity) || data.top_files || [];
        if (fileData && fileData.length){
            fileData.forEach(f=>{
                const item = document.createElement('div');
                const path = f.path||f||String(f);
                const score = f.score||f.green_score||0;
                const issues = (f.issues && f.issues.join(', ')) || '';
                item.style.padding='10px'; item.style.border='1px solid #eee'; item.style.margin='8px 0'; item.style.borderRadius='8px';
                item.innerHTML = `<div style='display:flex;justify-content:space-between;align-items:center'><div><code>${path}</code><div style='color:#666;font-size:0.9em'>${issues}</div></div><div style='text-align:right'><div style='font-weight:700'>${score}</div><div class='progress' style='width:120px;margin-top:6px'><div class='progress-fill' style='width:${score}%'></div></div></div></div>`;
                filesList.appendChild(item);
            });
        } else {
            filesList.textContent = 'No file-level data available.';
        }

        // Recommendations
        const recoList = document.getElementById('reco-list');
        const recs = data.recommendations || [];
        if (recs.length){
            recs.forEach(r=>{
                const el = document.createElement('div');
                el.style.padding='10px'; el.style.border='1px solid #f1f1f1'; el.style.margin='8px 0'; el.style.borderRadius='8px';
                el.innerHTML = `<strong>${r.title||'Recommendation'}</strong> <div style='color:#555'>${r.description||''}</div>`;
                recoList.appendChild(el);
            });
        } else {
            recoList.textContent = 'No recommendations.';
        }

        // Click-to-copy on file code elements
        document.querySelectorAll('#files-list code').forEach(c=>c.addEventListener('click', ()=>navigator.clipboard && navigator.clipboard.writeText(c.textContent)));

    } catch(e){
        console.error('dashboard interactive error', e);
    }
})();
